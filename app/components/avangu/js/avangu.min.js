/*! avangu - v1.0.0 - 2017-08-03
* Copyright (c) 2017 */
"use strict";angular.module("avangu",["avangu.helpers","avangu.plugins"]),angular.module("avangu.plugins",[]),angular.module("avangu.helpers",[]).constant("$AVGU_STATES",{PLAY:"playing",PAUSE:"paused",STOP:"stopped",EXIT:"exit"}).constant("$AVGU_EVENTS",{LOAD:"load"}).service("$AvguConfig",["$http","$q","$sce",function(a,b,c){this.load=function(d){var e=b.defer();return a({method:"GET",url:"components/avangu/assets/config.json"}).success(function(a){console.log(".::: config loaded successfully :::.",a);for(var b=a,d=0,f=b.source.length;f>d;d++)b.source[d].src=c.trustAsResourceUrl(b.source[d].src);e.resolve(b)}).error(function(){e.reject(".::: Error:: config loading :::."),console.log(".::: config loading failed :::.")}),e.promise}}]).service("$AvguFullscreen",[function(){function a(){for(var a in d)if(d[a].enabled in document){c=d[a];break}console.log(".::: FULLSCREEN:::: Check broswers :::.",c)}var b,c=null,d={w:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",onchange:"fullscreenchange",onerror:"fullscreenerror"},webkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},oldWebkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",onchange:"mozfullscreenchange",onerror:"mozfullscreenerror"},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",onchange:"MSFullscreenChange",onerror:"MSFullscreenError"},ios:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitEnterFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"}};a(),this.isAvailable=function(){return!!c},c&&(this.isFullscreen=function(){return!(null==document[c.element]&&!document.webkitIsFullScreen)},this.requestFullscreen=function(a){b=a,b[c.request](),console.log(".::: FULLSCREEN:::: REQUEST fullscreen :::.",c)},this.exitFullscreen=function(){document[c.exit](),console.log(".::: FULLSCREEN:::: EXIT fullscreen :::.",c)})}]),angular.module("avangu").controller("AvanguController",["$scope","$window","$AvguConfig","$AvguFullscreen","$AVGU_STATES",function(a,b,c,d,e){this.dev_mode=!1,this.avanguElement=null,this.playerElement=null,this.play=function(){var a=this;a.playerElement.play(),a.setState(e.PLAY),a.isPaused=!1,a.isPlaying=!0,console.log("PLAYING >",a.state)},this.pause=function(){var a=this;a.playerElement.pause(),a.setState(e.PAUSE),a.isPaused=!0,a.isPlaying=!1,console.log("PAUSED ||",a.state)},this.playPause=function(){var a=this;a.playerElement.paused?a.play():a.pause()},this.stop=function(){var a=this;try{a.playerElement.pause(),a.playerElement.currentTime=0,a.currentTime=0,a.buffered=[],a.setState(e.STOP),a.isPaused=!0,a.isPlaying=!1,console.log("PAUSE ||",a.state)}catch(b){return b}},this.restart=function(){var a=this;a.setTime(0)},this.skip=function(a){var b=this;b.setTime(a)},this.mute=function(){var a=this;a.playerElement.muted=!0,a.mute=!0},this.unmute=function(){var a=this;a.playerElement.muted=!1,a.mute=!1},this.toogleMute=function(){var a=this;a.playerElement.muted?a.mute():a.unmute()},this.clearSource=function(){var a=this;a.playerElement.src=""},this.setState=function(a){var b=this;return a&&a!=b.state&&(b.state=a),this.state},this.setTime=function(a){var b=this;try{0==a?b.playerElement.currentTime=a:(b.playerElement.currentTime+=a,b.currentTime+=a)}catch(c){console.log(".::: Error: setting time :::.",c)}b.currentTime=b.playerElement.currentTime},this.setVolume=function(a){var b,c=this.playerElement.volume;c+=a,vol>=0&&vol<=1?b.playerElement.volume=c:b.playerElement.volume=0>c?0:1},this.setPlayback=function(a){var b=this;b.playerElement.playbackRate=a,b.playback=a},this.setAutoplay=function(a){var b=this;b.playerElement.autoplay=!!a,b.autoplay=!!a},this.setLoop=function(a){var b=this;b.playerElement.loop=!!a,b.loop=!!a},this.toggleFullscreen=function(a){var b=this;b.isFullscreenAvailable&&(b.isFullscreen?d.exitFullscreen():d.requestFullscreen(b.playerElement))},this.onChangeSource=function(b){a.onChangeSource({$source:b}),console.log(".::: EVENT: Changing/setting Source :::.",b)},this.onComplete=function(){var b=this;a.onComplete(),b.setState(e.STOP),b.isCompleted=!0,a.$apply(),console.log(".::: EVENT::: COMPLETE :::.",b.state)},this.onError=function(b){a.onError({$event:b})},this.onCanPlay=function(b){this.buffering=!1,a.$apply(a.onCanPlay({$event:b})),console.log(".::: EVENT::: Can-play :::. ",b)},this.onPlay=function(){var b=this;b.setState(e.PLAY),a.$apply(),console.log(".::: EVENT::: PLAY :::.",b.state)},this.onPause=function(){var b=this;0==b.playerElement.currentTime?b.setState(e.STOP):b.setState(e.PAUSE),a.$apply(),console.log(".::: EVENT::: PAUSE :::.",b.state)},this.onVolumeChange=function(){var b=this;b.volume=b.playerElement.volume,a.$apply(),console.log(".::: EVENT::: VOLUME CHANGE :::.")},this.onPlaybackChange=function(){var b=this;b.playback=b.playerElement.playback,a.$apply(),console.log(".::: EVENT::: PLAYBACK CHANGE :::.")},this.onSeeking=function(){},this.ready=function(){var b=this;b.isReady=!0,b.autoplay=a.autoplay||!1,b.loop=a.loop||!1,b.mute=a.mute||!1,b.setState(e.STOP),b.isConfig?(console.log(".::: avangu player loding config :::.",b.configUrl),c.load(b.configUrl).then(b.onConfigLoad.bind(this))):a.onPlayerReady({$API:this}),console.log(".::: avangu player is ready :::.",b.state)},this.createListeners=function(){var a=this;a.playerElement.addEventListener("canplay",a.onCanPlay.bind(this),!1),a.playerElement.addEventListener("pause",a.onPause.bind(this),!1),a.playerElement.addEventListener("play",a.onPlay.bind(this),!1),a.playerElement.addEventListener("ended",a.onComplete.bind(this),!1),a.playerElement.addEventListener("volumechange",a.onVolumeChange.bind(this),!1),a.playerElement.addEventListener("playbackchange",a.onPlaybackChange.bind(this),!1),a.playerElement.addEventListener("seeking",a.onSeeking.bind(this),!1),a.playerElement.addEventListener("error",a.onError.bind(this),!1),console.log(".::: creating avangu event Listeners :::.")},this.init=function(){var b=this;b.isReady=!1,b.isComplete=!1,b.isPaused=!0,b.isPlaying=!1,b.isFullscreen=!!d.isFullscreen(),b.isFullscreenAvailable=!!d.isAvailable(),b.isConfig=void 0!=a.configUrl,b.isConfig&&(b.configUrl=a.configUrl),b.buffered=[],b.bufferedEnd=0,b.currentTime=0,b.totalTime=0,b.volume=0,b.state="",b.playback=1,console.log(".::: initializing avangu player :::.")},this.onConfigLoad=function(b){var c=this;c.config=b;for(var d in b)a.hasOwnProperty(d)||(c[d]=b[d]);console.log(".::: Config Loaded :::.",b)},this.log=function(a,b){var c=this;c.dev_mode&&console.log(a,b)},this.init()}]),angular.module("avangu").directive("avangu",["$timeout","$AVGU_STATES",function(a,b){return{restrict:"EA",controller:"AvanguController",controllerAs:"$API",scope:{configUrl:"@",autoplay:"=?",source:"=?",loop:"=?",preload:"=?",mute:"=?",nativeControls:"=?",updateTime:"&",updateState:"&",updateVolume:"&",updatePlayback:"&",dev_mode:"&",onCanPlay:"&",onPlayerReady:"&",onPlay:"&",onPause:"&",onStop:"&",onComplete:"&",onPlaybackUpdate:"&",onVolumeChange:"&",onFullScreen:"&",onChangeSource:"&",onSeeking:"&",onSeeked:"&",onError:"&"},link:{pre:function(a,b,c,d){var e=d;e.avanguElement=b,a.source&&(e.source=a.source),console.log(".::: avangu player directive :::.",a)}}}}]),angular.module("avangu").run(["$templateCache",function(a){a.put("avgu-templates/avgu-player-video","<video></video>"),a.put("avgu-templates/avgu-player-audio","<audio></audio>")}]).directive("avanguPlayer",["$timeout","$AVGU_STATES",function(a,b){return{restrict:"E",require:"^avangu",templateUrl:function(a,b){return b.type&&"audio"===b.type.toLowerCase()?b.type="audio":b.type="video","avgu-templates/avgu-player-"+b.type},scope:{type:"=?"},link:function(a,c,d,e){var f=e;a.onChangeSource=function(c,d){c!=d&&c&&(sources=c,f.state!==b.PLAY&&(f.state=b.STOP),f.source=sources,a.setSource(c)),console.log(".::: EVENT ON Changing SOurce Source Set :::.",c)},a.setSource=function(b){var c="";if(b&&f.playerElement.canPlayType)for(var d=0,e=b.length;e>d;d++)if(c=f.playerElement.canPlayType(b[d].type),"maybe"==c||"probably"==c){a.setAttrText("src",b[d].src),a.setAttrText("type",b[d].src),f.onChangeSource(b[d]);break}""==c&&f.onError(),console.log(".::: Video Source Set :::.",b)},a.setAttrBool=function(a,b){f.playerElement[a]=!!b},a.setAttrText=function(a,b){f.playerElement[a]=b},f.type=d.type,f.playerElement=c.find(d.type)[0],f.createListeners(),f.ready(),a.$watch(function(){return f.source},a.setSource),f.isConfig?a.$watch(function(){return f.config},function(){f.config&&(a.source=f.source,a.setAttrBool("autoplay",!!f.autoplay),a.setAttrBool("loop",!!f.loop),a.setAttrBool("muted",!!f.mute),a.setAttrBool("dev_mode",!!f.dev_mode))}):(a.$watch("autoplay",a.setAttrBool("autoplay",!!f.autoplay)),a.$watch("loop",a.setAttrBool("loop",!!f.loop)),a.$watch("mute",a.setAttrBool("muted",!!f.mute)),a.$watch("dev_mode",a.setAttrBool("dev_mode",!!f.loop))),f.log(".::: avangu player video plugin :::.")}}}]);